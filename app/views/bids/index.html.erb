<h1 class="mb-4">Bidding Dashboard</h1>

<%= form_with url: bids_path, method: :get, local: true, class: "row g-3 mb-4" do %>
  <div class="col-md-6">
    <%= text_field_tag :query, params[:query], placeholder: "Search listings...", class: "form-control" %>
  </div>
  <div class="col-md-4">
    <%= select_tag :status, options_for_select([["All", ""], ["Pending", "pending"], ["Awarded", "awarded"], ["Paid", "paid"], ["Rejected", "rejected"]], params[:status]), class: "form-select" %>
  </div>
  <div class="col-md-2">
    <%= submit_tag "Filter", class: "btn btn-primary w-100" %>
  </div>
<% end %>

<table class="table table-striped table-bordered">
  <thead class="table-dark">
  <tr>
    <th>Listing</th>
    <th>Bidder</th>
    <th>Amount</th>
    <th>Status</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  <% @bids.each do |bid| %>
    <tr>
      <td><%= link_to bid.listing.title, listing_path(bid.listing) %></td>
      <td><%= bid.user.name %></td>
      <td><%= number_to_currency(bid.amount) %></td>
      <td>
          <span class="badge <%= bid_badge_class(bid) %>">
            <%= bid.status.capitalize %>
          </span>
      </td>
      <td>
        <% if policy(bid).accept? && bid.pending? %>
          <%= link_to "Accept", accept_bid_path(bid), method: :patch, class: "btn btn-success btn-sm me-1" %>
          <%= link_to "Reject", reject_bid_path(bid), method: :patch, class: "btn btn-danger btn-sm" %>
        <% elsif bid.awarded? %>
          <%= link_to "Collect Payment", new_payment_path(bid_id: bid.id), class: "btn btn-primary btn-sm" %>
        <% else %>
          <em>N/A</em>
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>
