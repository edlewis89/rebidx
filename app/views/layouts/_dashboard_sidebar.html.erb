<div class="d-flex flex-column bg-light p-3 sidebar-sticky"
     style="width: 220px; min-height: 100vh;">
  <% if controller_name == "listings" %>
    <div class="mb-4">
      <h6 class="text-uppercase text-muted">Search</h6>

      <%= form_with url: listings_path, method: :get, local: true do %>

        <!-- Keyword -->
        <div class="mb-2">
          <%= text_field_tag :q,
                             params[:q],
                             placeholder: "Search jobsâ€¦",
                             class: "form-control form-control-sm",
                             onchange: "this.form.requestSubmit()" %>
        </div>

        <!-- Services -->
        <div class="mb-3">
          <label class="small fw-bold">Services</label>
          <% Service.order(:name).each do |service| %>
            <div class="form-check">
              <%= check_box_tag "service_ids[]",
                                service.id,
                                Array(params[:service_ids]).map(&:to_i).include?(service.id),
                                class: "form-check-input",
                                onchange: "this.form.requestSubmit()" %>

              <label class="form-check-label small">
                <%= service.name %>
                <% if defined?(@facets) && @facets.dig(:services, service.id) %>
                  (<%= @facets[:services][service.id] %>)
                <% end %>
              </label>
            </div>
          <% end %>
        </div>

        <!-- Budget -->
        <div class="mb-3">
          <label class="small fw-bold">Budget</label>

          <%= number_field_tag :min_budget,
                               params[:min_budget],
                               placeholder: "Min",
                               class: "form-control form-control-sm mb-1",
                               onchange: "this.form.requestSubmit()" %>

          <%= number_field_tag :max_budget,
                               params[:max_budget],
                               placeholder: "Max",
                               class: "form-control form-control-sm",
                               onchange: "this.form.requestSubmit()" %>
        </div>

      <% end %>
    </div>

    <hr>
  <% end %>

  <div class="advertisements">
    <p class="text-muted small">
      Ads loaded: <%= Advertisement.active.dashboard_sidebar.count %>
    </p>
    <% Advertisement.active.by_placement(:dashboard_sidebar).each do |ad| %>
      <div class="card mb-3 shadow-sm" style="width: 100%;">
        <% if ad.link.present? %>
          <%= link_to ad.link, target: "_blank", rel: "noopener" do %>
            <% if ad.image.attached? %>
              <%= image_tag ad.image, class: "card-img-top" %>
            <% else %>
              <div class="card-body">
                <h5 class="card-title"><%= ad.title %></h5>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <% if ad.image.attached? %>
            <%= image_tag ad.image, class: "card-img-top" %>
          <% else %>
            <div class="card-body">
              <h5 class="card-title"><%= ad.title %></h5>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>


  <h5>Menu</h5>
  <hr>

  <% if user_signed_in? %>

    <% if current_user.service_provider? || current_user.unlicensed_provider? %>
      <%= link_to "Dashboard",
                  provider_dashboard_path,
                  data: { turbo: false },
                  class: "nav-link mb-2" %>

      <%= link_to "My Bids",
                  provider_dashboard_path(anchor: "my-bids"),
                  data: { turbo: false },
                  class: "nav-link mb-2" %>

      <%= link_to "My Profile",
                  edit_profile_path,
                  data: { turbo: false },
                  class: "nav-link" %>

    <% elsif current_user.homeowner? %>
      <%= link_to "Dashboard",
                  homeowner_dashboard_path,
                  data: { turbo: false },
                  class: "nav-link mb-2" %>

        <% gate = ::MembershipGate.new(current_user) %>
        <% if gate.can_create_listing? %>
          <%= link_to "Post a Listing",
                      new_listing_path,
                      data: { turbo: false },
                      class: "btn btn-primary btn-sm mb-2" %>
       <% end %>
       <%= link_to "My Listings",
                  homeowner_dashboard_path(anchor: "my-listings"),
                  data: { turbo: false },
                  class: "nav-link mb-2" %>

    <% end %>

    <hr class="mt-auto">

    <%= button_to "Logout",
                  destroy_user_session_path,
                  method: :delete,
                  data: { turbo: false },
                  class: "nav-link text-danger" %>

  <% else %>

    <%= link_to "Sign In",
                new_user_session_path,
                class: "nav-link mb-2" %>

    <%= link_to "Sign Up",
                new_user_registration_path,
                class: "btn btn-outline-primary btn-sm" %>

  <% end %>
</div>